---
- name: Check if btop is installed
  shell: command -v btop
  register: btop_exists
  ignore_errors: yes
  changed_when: false
  failed_when: false

- name: Download and extract binary
  ansible.builtin.unarchive:
    src: https://github.com/aristocratos/btop/releases/download/v{{ btop_version }}/btop-x86_64-linux-musl.tbz
    dest: /tmp
    remote_src: yes
  when: btop_exists is failed

- name: Run 'install' target as root
  community.general.make:
    chdir: /tmp/btop
    target: install
  become: true
  when: btop_exists is failed

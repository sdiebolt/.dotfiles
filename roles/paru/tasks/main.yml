---
- name: Check if paru is installed
  ansible.builtin.shell: command -v paru
  register: paru_exists
  ignore_errors: true
  changed_when: false
  failed_when: false

- name: Install paru on Arch Linux
  when: ansible_facts["distribution"] == "Archlinux" and paru_exists.rc != 0
  block:
    - name: Install base-devel and git
      become: true
      community.general.pacman:
        name:
          - base-devel
          - git
        state: present

    - name: Clone paru repository
      ansible.builtin.git:
        repo: https://aur.archlinux.org/paru.git
        dest: /tmp/paru
        version: master
        depth: 1

    - name: Build and install paru
      ansible.builtin.shell: |
        cd /tmp/paru
        makepkg -si --noconfirm
      args:
        creates: /usr/bin/paru

    - name: Clean up temporary files
      ansible.builtin.file:
        path: /tmp/paru
        state: absent
